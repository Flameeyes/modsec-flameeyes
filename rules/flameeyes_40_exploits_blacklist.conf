# -*- apache -*-
# Copyright © 2010-2012 Diego Elio Pettenò <flameeyes@flameeyes.eu>
#

# If noticing access to known vulnerabilities, not only reject the
# request, but also put the IP address in a blacklist for a while.

SecRule REQUEST_URI "@beginsWith /w00tw00t" \
	"phase:1,msg:'Known vulnerability requested, %{REMOTE_ADDR} blacklisted.',setvar:ip.blacklisted=1,expirevar:ip.blacklisted=%{TX.IP_EXPIRATION}"

SecRule REQUEST_URI "@pm plm=0" \
	"phase:1,msg:'Known vulnerability requested, %{REMOTE_ADDR} blacklisted.',setvar:ip.blacklisted=1,expirevar:ip.blacklisted=%{TX.IP_EXPIRATION}"

SecRule REQUEST_URI "/Y-ivrrecording\.php" \
	"phase:1,msg:'Known vulnerability requested, %{REMOTE_ADDR} blacklisted.',setvar:ip.blacklisted=1,expirevar:ip.blacklisted=%{TX.IP_EXPIRATION}"

SecRule REQUEST_URI "/timthumb\.php?src=.*(?:picasa|blogger|flickr)\.com\..*" \
        "phase:1,msg:'Known vulnerability requested, %{REMOTE_ADDR} blacklisted.',setvar:ip.blacklisted=1,expirevar:ip.blacklisted=%{TX.IP_EXPIRATION}"

SecRule IP:BLACKLISTED "@eq 1" "phase:1,deny,status:403,nolog"
